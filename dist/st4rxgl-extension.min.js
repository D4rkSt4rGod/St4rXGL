!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).EntrySt4rXGL=t()}(this,function(){"use strict";class e{constructor(){this.scene=null,this.camera=null,this.renderer=null,this.objects=new Map,this.lights=new Map,this.materials=new Map,this.objectCounter=0,this.lightCounter=0,this.materialCounter=0,this.isInitialized=!1,this.animationId=null,this.init()}init(){this.setupThreeJS(),this.isInitialized=!0}setupThreeJS(){try{this.scene=new THREE.Scene,this.scene.background=new THREE.Color(8900331),this.scene.fog=new THREE.Fog(8900331,10,50),this.camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3),this.camera.position.set(5,5,10),this.camera.lookAt(0,0,0),this.renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0,powerPreference:"high-performance"}),this.renderer.setSize(800,600),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=THREE.PCFSoftShadowMap,this.renderer.setClearColor(0,0),this.setupDefaultLighting(),this.setupHelpers(),console.log("Three.js setup completed")}catch(e){console.error("Error setting up Three.js:",e)}}setupDefaultLighting(){let e=new THREE.AmbientLight(4210752,.6);this.scene.add(e),this.lights.set(this.lightCounter++,{type:"ambient",light:e});let t=new THREE.DirectionalLight(16777215,.8);t.position.set(10,10,5),t.castShadow=!0,t.shadow.mapSize.width=1024,t.shadow.mapSize.height=1024,this.scene.add(t),this.lights.set(this.lightCounter++,{type:"directional",light:t})}setupHelpers(){let e=new THREE.GridHelper(20,20,4473924,2236962);this.scene.add(e);let t=new THREE.AxesHelper(5);this.scene.add(t)}addObject(e,t=null,r="custom"){let s=this.objectCounter++,n=t||`${r}_${s}`;return e.castShadow=!0,e.receiveShadow=!0,this.objects.set(s,{id:s,name:n,mesh:e,type:r,visible:!0}),this.scene.add(e),s}getObject(e){return this.objects.get(e)}getAllObjects(){return Array.from(this.objects.values())}removeObject(e){let t=this.objects.get(e);return!!t&&(this.scene.remove(t.mesh),t.mesh.geometry&&t.mesh.geometry.dispose(),t.mesh.material&&(Array.isArray(t.mesh.material)?t.mesh.material.forEach(e=>e.dispose()):t.mesh.material.dispose()),this.objects.delete(e),!0)}startAnimation(){if(this.animationId)return;let e=()=>{this.animationId=requestAnimationFrame(e),this.render()};e()}stopAnimation(){this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null)}render(){this.scene&&this.camera&&this.renderer&&this.renderer.render(this.scene,this.camera)}cleanup(){this.stopAnimation(),this.objects.forEach((e,t)=>{this.scene.remove(e.mesh),e.mesh.geometry&&e.mesh.geometry.dispose(),e.mesh.material&&(Array.isArray(e.mesh.material)?e.mesh.material.forEach(e=>e.dispose()):e.mesh.material.dispose())}),this.objects.clear(),this.lights.forEach((e,t)=>{this.scene.remove(e.light),e.light.dispose&&e.light.dispose()}),this.lights.clear(),this.materials.forEach((e,t)=>{e.dispose&&e.dispose()}),this.materials.clear(),this.objectCounter=0,this.lightCounter=0,this.materialCounter=0}getDOMElement(){return this.renderer?this.renderer.domElement:null}}let t=[{type:"st4rxgl_create_box",color:"#FF6B6B",skeleton:"basic",statements:[],params:[{type:"Text",text:"정육면체 생성"},{type:"Text",text:"너비:"},{type:"Block",accept:"number"},{type:"Text",text:"높이:"},{type:"Block",accept:"number"},{type:"Text",text:"깊이:"},{type:"Block",accept:"number"},{type:"Text",text:"색상:"},{type:"Colour",colour:"#ff0000"}],def:{params:[null,null,{type:"number",params:["1"]},null,{type:"number",params:["1"]},null,{type:"number",params:["1"]},null,"#ff0000"],type:"st4rxgl_create_box"},paramsKeyMap:{WIDTH:2,HEIGHT:4,DEPTH:6,COLOR:8},func:function(e,t){let r=t.getNumberValue("WIDTH",t),s=t.getNumberValue("HEIGHT",t),n=t.getNumberValue("DEPTH",t),i=t.getField("COLOR");if(window.St4rXGL&&window.St4rXGL.objectManager){let a=window.St4rXGL.objectManager.createBox(r,s,n,i);return a}return -1},syntax:{js:[],py:[]}},{type:"st4rxgl_create_sphere",color:"#4ECDC4",skeleton:"basic",statements:[],params:[{type:"Text",text:"구 생성"},{type:"Text",text:"반지름:"},{type:"Block",accept:"number"},{type:"Text",text:"색상:"},{type:"Colour",colour:"#00ff00"}],def:{params:[null,null,{type:"number",params:["1"]},null,"#00ff00"],type:"st4rxgl_create_sphere"},paramsKeyMap:{RADIUS:2,COLOR:4},func:function(e,t){let r=t.getNumberValue("RADIUS",t),s=t.getField("COLOR");if(window.St4rXGL&&window.St4rXGL.objectManager){let n=window.St4rXGL.objectManager.createSphere(r,s);return n}return -1},syntax:{js:[],py:[]}}],r=[{type:"st4rxgl_set_position",color:"#FFA500",skeleton:"basic",statements:[],params:[{type:"Text",text:"객체 ID:"},{type:"Block",accept:"number"},{type:"Text",text:"X:"},{type:"Block",accept:"number"},{type:"Text",text:"Y:"},{type:"Block",accept:"number"},{type:"Text",text:"Z:"},{type:"Block",accept:"number"}],def:{params:[null,{type:"number",params:["0"]},null,{type:"number",params:["0"]},null,{type:"number",params:["0"]},null,{type:"number",params:["0"]}],type:"st4rxgl_set_position"},paramsKeyMap:{OBJECT_ID:1,X:3,Y:5,Z:7},func:function(e,t){let r=t.getNumberValue("OBJECT_ID",t),s=t.getNumberValue("X",t),n=t.getNumberValue("Y",t),i=t.getNumberValue("Z",t);if(window.St4rXGL&&window.St4rXGL.objectManager){let a=window.St4rXGL.objectManager.setPosition(r,s,n,i);return a}return!1},syntax:{js:[],py:[]}}],s=[{type:"st4rxgl_start_animation",color:"#FF1493",skeleton:"basic",statements:[],params:[{type:"Text",text:"3D 애니메이션 시작"}],events:{},def:{params:[],type:"st4rxgl_start_animation"},func:function(e,t){return!!window.St4rXGL&&!!window.St4rXGL.renderManager&&(window.St4rXGL.renderManager.startRendering(),!0)},syntax:{js:[],py:[]}}],n={name:"St4rXGL 3D Extension",description:"WebGL과 Three.js를 이용한 3D 작품 제작 확장 프로그램",version:"1.0.0",author:"St4rXGL Team",category:"arduino",img:"./assets/icons/st4rxgl_icon.png",core:null,init:function(){console.log("St4rXGL 확장 프로그램 초기화 중..."),this.core=new e,this.loadThreeJS().then(()=>{console.log("Three.js loaded successfully"),this.core.setupThreeJS()}).catch(e=>{console.error("Failed to load Three.js:",e)}),this.setupEventListeners(),console.log("St4rXGL 확장 프로그램이 초기화되었습니다.")},loadThreeJS:function(){return new Promise((e,t)=>{if(window.THREE){e();return}let r=document.createElement("script");r.src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js",r.onload=()=>{console.log("Three.js loaded successfully"),e()},r.onerror=()=>{console.error("Failed to load Three.js"),t(Error("Failed to load Three.js"))},document.head.appendChild(r)})},setupEventListeners:function(){Entry&&Entry.addEventListener&&(Entry.addEventListener("stop",this.onStop.bind(this)),Entry.addEventListener("play",this.onPlay.bind(this)))},onPlay:function(){this.core&&this.core.startAnimation()},onStop:function(){this.core&&this.core.cleanup()},objectManager:{createBox:function(e=1,t=1,r=1,s=16711680){if(!window.St4rXGL||!window.St4rXGL.core)return -1;let n=new THREE.BoxGeometry(e,t,r),i=new THREE.MeshStandardMaterial({color:s}),a=new THREE.Mesh(n,i);return window.St4rXGL.core.addObject(a,"box","box")},createSphere:function(e=1,t=65280){if(!window.St4rXGL||!window.St4rXGL.core)return -1;let r=new THREE.SphereGeometry(e,32,32),s=new THREE.MeshStandardMaterial({color:t}),n=new THREE.Mesh(r,s);return window.St4rXGL.core.addObject(n,"sphere","sphere")},setPosition:function(e,t,r,s){if(!window.St4rXGL||!window.St4rXGL.core)return!1;let n=window.St4rXGL.core.getObject(e);return!!n&&(n.mesh.position.set(t,r,s),!0)}},renderManager:{startRendering:function(){if(!window.St4rXGL||!window.St4rXGL.core)return;window.St4rXGL.core.startAnimation();let e=document.getElementById("entry-stage");if(e&&window.St4rXGL.core.getDOMElement()){let t=e.querySelector(".st4rxgl-canvas");t&&t.remove();let r=window.St4rXGL.core.getDOMElement();r.classList.add("st4rxgl-canvas"),r.style.position="absolute",r.style.top="0",r.style.left="0",r.style.zIndex="10",e.style.position="relative",e.appendChild(r)}}},blocks:[...t,...r,...s]};return"undefined"!=typeof Entry&&Entry.register(n),window.St4rXGL=n,n});